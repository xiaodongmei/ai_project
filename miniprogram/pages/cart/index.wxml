<view class="container">
  <!-- ç©ºè´­ç‰©è½¦ -->
  <view wx:if="{{cartItems.length === 0}}" class="empty-cart">
    <view class="empty-icon">ğŸ›’</view>
    <view class="empty-text">è´­ç‰©è½¦ä¸ºç©º</view>
    <button class="btn btn-primary" bindtap="continueShopping">ç»§ç»­è´­ç‰©</button>
  </view>

  <!-- è´­ç‰©è½¦å†…å®¹ -->
  <view wx:if="{{cartItems.length > 0}}" class="cart-content">
    <!-- è´­ç‰©è½¦å¤´éƒ¨ -->
    <view class="cart-header">
      <view class="header-left">
        <text>è´­ç‰©è½¦</text>
        <text class="cart-count">({{cartItems.length}}ä»¶)</text>
      </view>
      <view class="header-right">
        <text class="edit-btn" bindtap="toggleEditMode">{{isEditMode ? 'å®Œæˆ' : 'ç¼–è¾‘'}}</text>
      </view>
    </view>

    <!-- è´­ç‰©è½¦åˆ—è¡¨ -->
    <view class="cart-list">
      <view class="cart-top-bar">
        <view class="checkbox-wrapper">
          <checkbox
            class="checkbox"
            checked="{{selectedItems.size === cartItems.length && cartItems.length > 0}}"
            bindchange="toggleSelectAll"
          />
          <text>å…¨é€‰</text>
        </view>
        <view wx:if="{{isEditMode}}" class="delete-btn" bindtap="deleteSelectedItems">åˆ é™¤</view>
      </view>

      <view wx:for="{{cartItems}}" wx:key="id" class="cart-item">
        <view class="item-checkbox">
          <checkbox
            class="checkbox"
            checked="{{selectedItems.has(index)}}"
            data-index="{{index}}"
            bindchange="toggleItemSelection"
          />
        </view>

        <view class="item-content" bindtap="toggleItemSelection" data-index="{{index}}">
          <image class="item-image" src="{{item.image_url || '/images/placeholder.png'}}" />

          <view class="item-info">
            <view class="item-name">{{item.name}}</view>
            <view class="item-specs" wx:if="{{item.specifications}}">
              <text wx:for="{{item.specifications}}" wx:key="this" class="spec-tag">
                {{item}}
              </text>
            </view>
            <view class="item-price">Â¥{{item.price}}</view>
          </view>
        </view>

        <view class="item-actions">
          <view class="quantity-control">
            <button class="qty-btn" data-index="{{index}}" bindtap="decreaseQuantity">âˆ’</button>
            <input
              class="qty-input"
              type="number"
              value="{{item.quantity}}"
              data-index="{{index}}"
              bindinput="onQuantityInput"
              min="1"
              max="999"
            />
            <button class="qty-btn" data-index="{{index}}" bindtap="increaseQuantity">+</button>
          </view>

          <view class="item-delete" wx:if="{{isEditMode}}" data-index="{{index}}" bindtap="removeItem">
            ğŸ—‘ï¸
          </view>
        </view>
      </view>
    </view>

    <!-- è´­ç‰©è½¦åº•éƒ¨ -->
    <view class="cart-footer">
      <view class="summary">
        <view class="summary-item">
          <text class="summary-label">åˆè®¡:</text>
          <text class="summary-value">Â¥{{totalPrice}}</text>
        </view>
        <view class="summary-item" wx:if="{{totalQuantity > 0}}">
          <text class="summary-label">æ•°é‡:</text>
          <text class="summary-value">{{totalQuantity}}</text>
        </view>
      </view>

      <view class="footer-buttons">
        <button class="btn btn-secondary" bindtap="continueShopping">ç»§ç»­è´­ç‰©</button>
        <button class="btn btn-primary" bindtap="checkout" wx:if="{{!isEditMode}}">
          ç«‹å³ç»“ç®— ({{selectedItems.size}})
        </button>
        <button class="btn btn-danger" bindtap="deleteSelectedItems" wx:if="{{isEditMode}}">
          åˆ é™¤é€‰ä¸­
        </button>
      </view>
    </view>
  </view>
</view>
