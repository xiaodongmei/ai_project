<view class="container">
  <view wx:if="{{!user}}" class="not-logged-in">
    <view class="empty-icon">ğŸ‘¤</view>
    <view class="empty-text">æœªç™»å½•</view>
    <button class="btn btn-primary" open-type="navigate" href="/pages/login/index">
      å»ç™»å½•
    </button>
  </view>

  <view wx:if="{{user}}" class="profile-content">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="user-card">
      <view class="user-avatar">
        {{user.name.substring(0, 1).toUpperCase()}}
      </view>
      <view class="user-info">
        <view class="user-name">{{user.name || 'ç”¨æˆ·å'}}</view>
        <view class="user-email">{{user.email}}</view>
      </view>
    </view>

    <!-- æ•°æ®ç»Ÿè®¡ -->
    <view class="statistics">
      <view class="stat-item">
        <view class="stat-value">{{statistics.totalOrders}}</view>
        <view class="stat-label">æ€»è®¢å•</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{statistics.pendingOrders}}</view>
        <view class="stat-label">å¾…æ”¯ä»˜</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">{{statistics.completedOrders}}</view>
        <view class="stat-label">å·²å®Œæˆ</view>
      </view>
      <view class="stat-item">
        <view class="stat-value">Â¥{{statistics.totalSpent}}</view>
        <view class="stat-label">æ€»æ¶ˆè´¹</view>
      </view>
    </view>

    <!-- æ”¶è´§åœ°å€ -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">æ”¶è´§åœ°å€</text>
        <text class="edit-btn" bindtap="editAddress" wx:if="{{!editingAddress}}">ç¼–è¾‘</text>
      </view>

      <!-- æŸ¥çœ‹æ¨¡å¼ -->
      <view wx:if="{{!editingAddress}}" class="address-display">
        <view wx:if="{{address}}" class="address-content">
          <view class="address-text">{{address}}</view>
          <view class="phone-text" wx:if="{{phone}}">{{phone}}</view>
        </view>
        <view wx:if="{{!address}}" class="empty-address">
          æš‚æœªè®¾ç½®æ”¶è´§åœ°å€ï¼Œç‚¹å‡»ç¼–è¾‘æ·»åŠ 
        </view>
      </view>

      <!-- ç¼–è¾‘æ¨¡å¼ -->
      <view wx:if="{{editingAddress}}" class="address-edit">
        <view class="form-group">
          <label>æ”¶è´§åœ°å€</label>
          <textarea
            class="form-input"
            placeholder="è¯·è¾“å…¥æ”¶è´§åœ°å€"
            value="{{address}}"
            bindinput="onAddressChange"
            maxlength="200"
          ></textarea>
          <view class="char-count">{{address.length}}/200</view>
        </view>

        <view class="form-group">
          <label>è”ç³»ç”µè¯</label>
          <input
            class="form-input"
            type="tel"
            placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯"
            value="{{phone}}"
            bindinput="onPhoneChange"
          />
        </view>

        <view class="button-group">
          <button class="btn btn-secondary" bindtap="cancelEdit">å–æ¶ˆ</button>
          <button class="btn btn-primary" bindtap="saveAddress">ä¿å­˜</button>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„è®¢å• -->
    <view class="section">
      <view class="section-title">æˆ‘çš„è®¢å•</view>
      <view class="menu-item" bindtap="goToOrders">
        <text class="menu-text">æŸ¥çœ‹æ‰€æœ‰è®¢å•</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>

    <!-- æ›´å¤šåŠŸèƒ½ -->
    <view class="section">
      <view class="section-title">æ›´å¤š</view>
      <view class="menu-item" bindtap="goToFavorites">
        <text class="menu-text">â¤ï¸ æˆ‘çš„æ”¶è—</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToHelp">
        <text class="menu-text">â“ å¸®åŠ©ä¸­å¿ƒ</text>
        <text class="menu-arrow">â€º</text>
      </view>
      <view class="menu-item" bindtap="goToAbout">
        <text class="menu-text">â„¹ï¸ å…³äºæˆ‘ä»¬</text>
        <text class="menu-arrow">â€º</text>
      </view>
    </view>

    <!-- ç™»å‡ºæŒ‰é’® -->
    <view class="logout-section">
      <button class="btn btn-logout" bindtap="logout">ç™»å‡º</button>
    </view>
  </view>
</view>
