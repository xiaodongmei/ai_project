<view class="container">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="spinner"></view>
    <text>加载中...</text>
  </view>

  <view wx:if="{{!loading && product}}" class="product-detail">
    <!-- 产品图片 -->
    <view class="image-section">
      <image class="product-image" src="{{product.image_url || '/images/placeholder.png'}}" />
      <view wx:if="{{product.is_featured}}" class="featured-badge">推荐产品</view>
    </view>

    <!-- 产品信息 -->
    <view class="product-info">
      <view class="product-header">
        <view class="product-name">{{product.name}}</view>
        <view class="product-rating" wx:if="{{product.rating}}">
          <text class="stars">⭐ {{product.rating}}</text>
          <text class="sales-count" wx:if="{{product.sales_count}}">({{product.sales_count}}人购买)</text>
        </view>
      </view>

      <!-- 价格信息 -->
      <view class="price-section">
        <view class="price-group">
          <text class="label">会员价:</text>
          <text class="price">¥{{product.member_price}}</text>
        </view>
        <view class="price-group" wx:if="{{product.non_member_price !== product.member_price}}">
          <text class="label">非会员价:</text>
          <text class="price-original">¥{{product.non_member_price}}</text>
        </view>
      </view>

      <!-- 库存信息 -->
      <view class="stock-section">
        <text class="stock-label" wx:if="{{product.stock_quantity > 0}}">库存充足</text>
        <text class="stock-label warning" wx:if="{{product.stock_quantity <= product.low_stock_alert && product.stock_quantity > 0}}"
          >库存不足</text
        >
        <text class="stock-label danger" wx:if="{{product.stock_quantity === 0}}">已售罄</text>
      </view>

      <!-- 产品描述 -->
      <view class="description-section">
        <view class="section-title">产品描述</view>
        <view class="description-text">{{product.description}}</view>
        <view class="detailed-description" wx:if="{{product.detailed_description}}">
          {{product.detailed_description}}
        </view>
      </view>

      <!-- 产品规格 -->
      <view class="specifications-section" wx:if="{{product.specification}}">
        <view class="section-title">产品规格</view>
        <view class="specs-grid">
          <view class="spec-item">
            <text class="spec-label">规格:</text>
            <text class="spec-value">{{product.specification}}</text>
          </view>
          <view class="spec-item" wx:if="{{product.weight}}">
            <text class="spec-label">重量:</text>
            <text class="spec-value">{{product.weight}}</text>
          </view>
          <view class="spec-item">
            <text class="spec-label">单位:</text>
            <text class="spec-value">{{product.unit || '个'}}</text>
          </view>
        </view>
      </view>

      <!-- 购买选项 -->
      <view class="purchase-section">
        <view class="quantity-section">
          <text class="quantity-label">数量:</text>
          <view class="quantity-control">
            <button class="qty-btn" bindtap="decreaseQuantity">−</button>
            <input
              class="qty-input"
              type="number"
              value="{{quantity}}"
              bindinput="onQuantityInput"
              min="1"
              max="999"
            />
            <button class="qty-btn" bindtap="increaseQuantity">+</button>
          </view>
        </view>
      </view>

      <!-- 底部操作栏 -->
      <view class="action-buttons">
        <button class="btn btn-secondary" bindtap="addToCart" wx:if="{{product.stock_quantity > 0}}">
          加入购物车
        </button>
        <button class="btn btn-primary" bindtap="buyNow" wx:if="{{product.stock_quantity > 0}}">
          立即购买
        </button>
        <button class="btn btn-disabled" wx:if="{{product.stock_quantity === 0}}" disabled>
          已售罄
        </button>
      </view>
    </view>
  </view>

  <view wx:if="{{!loading && !product}}" class="empty-state">
    <view class="empty-icon">❌</view>
    <view class="empty-text">产品加载失败</view>
  </view>
</view>
