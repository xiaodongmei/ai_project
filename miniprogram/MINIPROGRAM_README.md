# 养生店管理小程序 - 客户端

## 项目概述

养生店管理系统的微信小程序客户端，为用户提供产品浏览、购物、订单管理等功能。

## 功能清单

### ✅ 已完成功能

#### 1. 认证系统 (`/pages/login/`)
- **密码登录** - 手机号+密码登录
- **验证码登录** - 手机号+验证码登录
- **微信授权登录** - 使用微信身份验证
- **Token管理** - 自动刷新和过期管理
- **路由保护** - 自动检测登录状态

#### 2. 首页 (`/pages/index/`)
- **轮播图展示** - 动态轮播广告
- **分类导航** - 快速访问产品分类
- **推荐产品** - 展示特色产品
- **搜索入口** - 导航到产品搜索
- **快速加购** - 一键添加到购物车
- **下拉刷新** - 更新首页数据

#### 3. 产品管理 (`/pages/product/`)

##### 产品列表 (index.js/wxml/wxss)
- **产品列表** - 分页加载产品
- **分类筛选** - 按分类筛选产品
- **搜索功能** - 按名称搜索产品
- **排序排列** - 网格展示产品
- **快速加购** - 快捷添加到购物车
- **上拉加载** - 无限滚动加载更多
- **返回顶部** - 快速回到顶部

##### 产品详情 (detail.js/wxml/wxss)
- **产品信息展示** - 名称、描述、图片
- **价格显示** - 会员价/非会员价
- **库存状态** - 库存充足/不足/售罄
- **规格选择** - 产品规格展示
- **评分评价** - 显示产品评分和销量
- **数量控制** - 增加/减少/手动输入数量
- **加入购物车** - 支持选择规格后加入
- **立即购买** - 快速结算功能
- **分享功能** - 分享产品链接

#### 4. 购物车 (`/pages/cart/`)
- **购物车列表** - 展示所有购物车商品
- **选择商品** - 支持单选/全选
- **编辑模式** - 切换编辑和查看模式
- **修改数量** - 调整购物车商品数量
- **删除商品** - 单个或批量删除
- **金额计算** - 自动计算总价和数量
- **继续购物** - 快速返回继续购物
- **立即结算** - 进入订单确认页面
- **清空购物车** - 一键清空所有商品

#### 5. 订单管理 (`/pages/order/`)

##### 订单列表 (index.js/wxml/wxss)
- **订单筛选** - 按状态筛选订单（全部/待支付/已完成/已取消）
- **订单列表** - 展示订单信息和商品
- **订单详情** - 查看订单详细信息
- **取消订单** - 待支付订单可取消
- **删除订单** - 已完成订单可删除
- **上拉加载** - 分页加载订单

##### 订单详情 (detail.js/wxml/wxss)
- **新订单创建** - 确认商品、填写地址、选择支付方式
- **现有订单查看** - 查看订单详情和状态
- **地址管理** - 输入/编辑收货地址
- **支付方式选择** - 微信支付/支付宝/货到付款
- **订单备注** - 添加订单备注信息
- **金额汇总** - 显示商品总价和应付金额
- **取消订单** - 待支付订单可以取消
- **微信支付** - 集成微信支付功能

#### 6. 个人中心 (`/pages/profile/`)
- **用户信息展示** - 显示用户名和邮箱
- **数据统计** - 显示订单数、消费金额等
- **收货地址管理** - 查看/编辑收货地址
- **电话号码管理** - 保存常用联系电话
- **我的订单** - 快速跳转订单列表
- **我的收藏** - 收藏功能入口
- **帮助中心** - 帮助文档入口
- **关于我们** - 关于页面入口
- **登出功能** - 安全登出并返回登录页

### 📦 核心功能模块

#### 请求工具 (`utils/request.js`)
- **HTTP请求管理** - 封装wx.request
- **Token管理** - 自动添加认证头
- **Token刷新** - 自动刷新过期token
- **请求队列** - 防止多个token刷新请求
- **错误处理** - 统一错误处理机制
- **超时配置** - 可配置的请求超时
- **数据持久化** - Token和用户信息存储

#### API接口 (`api/miniprogram.js`)
- **产品接口** - 分类、列表、详情、推荐
- **订单接口** - 创建、查询、取消、删除
- **用户接口** - 信息、地址、统计
- **认证接口** - 登录、验证码、token刷新
- **支付接口** - 支付信息、状态更新

## 页面结构

```
miniprogram/
├── pages/
│   ├── index/              # 首页
│   │   ├── index.js
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── login/              # 登录页
│   │   ├── index.js
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── product/            # 产品管理
│   │   ├── index.js        # 列表页
│   │   ├── index.wxml
│   │   ├── index.wxss
│   │   ├── detail.js       # 详情页
│   │   ├── detail.wxml
│   │   └── detail.wxss
│   ├── cart/               # 购物车
│   │   ├── index.js
│   │   ├── index.wxml
│   │   └── index.wxss
│   ├── order/              # 订单管理
│   │   ├── index.js        # 订单列表
│   │   ├── index.wxml
│   │   ├── index.wxss
│   │   ├── detail.js       # 订单详情
│   │   ├── detail.wxml
│   │   └── detail.wxss
│   └── profile/            # 个人中心
│       ├── index.js
│       ├── index.wxml
│       └── index.wxss
├── api/
│   └── miniprogram.js      # API接口定义
├── components/             # 公共组件
├── styles/                 # 公共样式
├── utils/
│   ├── request.js          # HTTP请求工具
│   └── util.js             # 工具函数
├── images/                 # 图片资源
├── app.js                  # 应用入口
├── app.json                # 应用配置
└── MINIPROGRAM_README.md   # 说明文档
```

## 数据流转

### 用户登录流程
```
登录页 -> 发送登录请求 -> 后端验证 -> 返回Token -> 保存到本地 -> 跳转首页
```

### 购物流程
```
浏览产品 -> 加入购物车 -> 查看购物车 -> 结算 -> 填写地址 -> 选择支付方式 -> 提交订单 -> 支付 -> 完成
```

### 订单管理流程
```
查看订单列表 -> 筛选订单 -> 查看订单详情 -> 取消/删除/支付
```

## API接口对接

小程序与后端API通过以下接口对接：

### 认证类
- POST `/auth/login` - 用户登录
- POST `/auth/send-code` - 发送验证码
- POST `/auth/wechat-login` - 微信登录
- POST `/auth/refresh-token` - 刷新token

### 产品类
- GET `/products/categories` - 获取分类
- GET `/products/list` - 获取产品列表
- GET `/products/featured` - 获取推荐产品
- GET `/products/{id}` - 获取产品详情

### 订单类
- POST `/orders/create` - 创建订单
- GET `/orders/my-orders` - 获取我的订单
- GET `/orders/{id}` - 获取订单详情
- POST `/orders/{id}/cancel` - 取消订单
- DELETE `/orders/{id}` - 删除订单
- POST `/orders/{id}/payment` - 获取支付信息
- GET `/orders/statistics` - 获取统计信息

### 用户类
- GET `/users/profile` - 获取用户信息
- POST `/users/update-address` - 更新地址
- POST `/users/update-profile` - 更新用户信息

### 支付类
- POST `/payments/wechat` - 获取微信支付参数
- POST `/payments/status` - 更新支付状态

## 存储管理

小程序使用wx.storage进行数据持久化：

| 键名 | 说明 | 类型 |
|------|------|------|
| `access_token` | 访问令牌 | String |
| `refresh_token` | 刷新令牌 | String |
| `user` | 用户信息 | JSON String |
| `cart` | 购物车数据 | JSON String |
| `orderItems` | 待结算订单项 | JSON String |

## 样式设计

- **主色调** - 蓝色 (#1890ff) 用于主要操作
- **强调色** - 红色 (#ff4d4f) 用于价格和重要提示
- **背景色** - 浅灰色 (#f5f5f5) 用于页面背景
- **文本色** - 深灰色 (#333) 用于主文本
- **响应式设计** - 支持各种屏幕尺寸

## 开发建议

### 后端需要实现的接口

确保后端已实现以下功能：

1. **认证服务**
   - 密码登录和验证码登录
   - Token生成和刷新机制
   - 微信登录集成

2. **产品服务**
   - 产品分类管理
   - 产品列表查询和搜索
   - 产品详情查询
   - 推荐产品列表

3. **订单服务**
   - 订单创建
   - 订单查询和列表
   - 订单取消和删除
   - 订单统计

4. **用户服务**
   - 用户信息管理
   - 地址管理
   - 用户统计

5. **支付服务**
   - 微信支付集成
   - 支付状态管理

### 测试建议

1. **本地开发**
   - 修改 `app.js` 中的 `apiUrl` 为本地后端地址
   - 使用微信开发者工具进行调试

2. **完整流程测试**
   - 登录功能测试
   - 产品浏览和搜索
   - 购物车和订单流程
   - 支付流程

3. **边界情况处理**
   - 网络错误处理
   - Token过期刷新
   - 库存不足处理
   - 订单冲突处理

## 待优化项

- [ ] 添加更多公共组件库
- [ ] 实现产品收藏功能
- [ ] 实现用户评价功能
- [ ] 优化图片加载和缓存
- [ ] 完善错误提示和日志
- [ ] 添加更多支付方式
- [ ] 实现订单追踪功能
- [ ] 优化性能和加载速度

## 许可证

MIT License
